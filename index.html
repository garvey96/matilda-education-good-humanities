<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Good Humanities - Matilda Education</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script>
            const pageDict = [
                "i",
                "ii",
                "history",
                "contents",
                "v",
                "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63", "64", "65", "66", "67", "68", "69", "70", "71", "72", "73", "74", "75", "76", "77", "78", "79", "80", "81", "82", "83", "84", "85", "86", "87", "88", "89", "90", "91", "92", "93", "94", "95", "96", "97", "98", "99", "100", "101", "102", "103", "104", "105", "106", "107", "108", "109", "110", "111", "112", "113", "114", "115", "116", "117", "118", "119", "120", "121", "122", "123", "124", "125", "126", "127", "128", "129", "130", "131", "132", "133", "134", "135", "136", "137", "138", "139", "140", "141", "142", "143", "144", "145", "146", "147", "148", "149", "150", "151", "152", "153", "154", "155", "156", "157", "158", "159", "160", "161", "162", "163", "164", "165", "166", "167", "168", "169", "170", "171", "172", "173", "174", "175", "176", "177", "178", "179", "180", "181", "182", "183", "184", "185", "186", "187", "188", "189", "190", "191", "192", "193", "194", "195", "196", "197", "198", "199", "200", "201", "202", "203", "204", "205", "206", "207", "208", "209", "210", "211", "212", "213", "214", "215", "216", "217", "218", "219", "220", "221", "222", "223", "224", "225", "226", "227", "228", "229", "230", "231", "232", "233", "234", "235", "236", "237", "238", "239", "240", "241", "242", "243", "244", "245", "246", "247", "248", "249", "250", "251", "252", "253", "254", "255", "256", "257", "258", "259", "260", "261", "262", "263", "264", "265", "266", "267", "268", "269", "270", "271", "272", "273", "274", "275", "276", "277", "278", "279", "280",
                "geography",
                "contents",
                "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63", "64", "65", "66", "67", "68", "69", "70", "71", "72", "73", "74", "75", "76", "77", "78", "79", "80", "81", "82", "83", "84", "85", "86", "87", "88", "89", "90", "91", "92", "93", "94", "95", "96", "97", "98", "99", "100", "101", "102", "103", "104", "105", "106", "107", "108", "109", "110", "111", "112", "113", "114", "115", "116", "117", "118", "119", "120", "121", "122", "123", "124", "125", "126", "127", "128", "129", "130", "131", "132", "133", "134", "135", "136", "137", "138", "139", "140", "141", "142", "143", "144", "145", "146", "147", "148", "149", "150", "151", "152", "153", "154", "155", "156", "157", "158", "159", "160"
            ];

            function resizeIframe(obj) {
                obj.style.height = obj.contentWindow.document.documentElement.scrollHeight + 'px';
            }
            var page;
            var currentPage = 1;
            function jumpToPage()
            {
                let r = getPageIndex(document.getElementById("pageNo").value);

                document.getElementById("pageNo").blur();
                console.log(r, document.getElementById("pageNo").value)
                document.getElementById("pageNo").value = "";
                if(Number.isInteger(r))
                {
                    currentPage = r;
                    if(currentPage<1)
                    {
                        currentPage = 1;
                    }
                    if(currentPage>234)
                    {
                        currentPage = 234;
                    }
                    updatePages(currentPage);
                }
            }
            function incrementPage(i)
            {
                currentPage += i;
                if(currentPage<1)
                {
                    currentPage = 1;
                }
                else
                {
                    updatePages(currentPage);
                }
            }
            function updatePages(pageIndex)
            {
                if(pageIndex == 1)
                {
                    document.getElementById("back").style.visibility = "hidden";
                }
                else
                {
                    document.getElementById("back").style.visibility = "visible";
                }
                if(pageIndex == 224)
                {
                    document.getElementById("forward").style.visibility = "hidden";
                }
                else
                {
                    document.getElementById("forward").style.visibility = "visible";
                }
                const pageNo = getPageNo(pageIndex);
                loadPage(pageIndex*2 - 1, 0);
                loadPage(pageIndex*2, 1);
                var a;
                console.log(pageIndex)
                if(currentPage == 224)
                {
                    a = pageDict[pageIndex*2-2].toString();
                }
                else
                {
                    a = (pageDict[pageIndex*2-2].toString() + " - " + pageDict[pageIndex*2-1].toString());
                }

                document.getElementById("pageNo").placeholder = a;
                const url = new URL(window.location);
                url.searchParams.set("p", currentPage);
                window.history.pushState({}, '', url);
                if(currentPage > 143)
                {
                    document.getElementById("sections").value = "Geography";
                    bookSection = false;
                }
                else
                {
                    document.getElementById("sections").value = "History";
                    bookSection = true;
                }
            }
            function loadPage(pageNo, targetPage)
            {
                page[targetPage].src = "https://mydigital.matildaeducation.com.au/production_content/epub_content/9780655090243-80.1.1/OEBPS/page"+ String(pageNo).padStart(4,'0') +".xhtml"
            }
            function getPageNo(pageIndex)
            {
                if(bookSection)
                {
                    return(pageIndex*2-5);
                }
                else
                {
                    return(pageIndex*2-287);
                }
            }
            function getPageIndex(pageNo)
            {
                if(bookSection)
                {
                    console.log("true")
                    return(Math.ceil((parseInt(pageNo)+5)/2));
                }
                else
                {
                    console.log(false)
                    return(Math.ceil((parseInt(pageNo)+287)/2));
                }
            }
            var bookSection = true;
            window.onload = function()
            {
                const urlPage = new URL(window.location).searchParams.get("p");
                
                if(urlPage)
                {
                    currentPage = parseInt(urlPage);
                }
                var form = document.getElementById("form");
                function handleForm(event) { event.preventDefault(); } 
                form.addEventListener('submit', handleForm);


                page = [document.getElementById("page1"), document.getElementById("page2")];

                const el = document.getElementById("container");
                updatePages(currentPage);

                // function doResize() {
                //     const width = window.innerWidth;
                //     const scale = Math.min(
                //         window.innerHeight / (1212+10),    
                //         width / (935*2+10)
                //     );
                    
                //     el.style.transform = "scale(" + (scale).toString() + ")";
                //     el.style.transformOrigin = "top left";                
                // }
                // window.addEventListener('resize', doResize);
                // doResize();
            }
            
            function changeSection()
            {
                if(document.getElementById("sections").value == "History")
                {
                    bookSection = true;
                    currentPage = 2;
                }
                else
                {
                    bookSection = false;
                    currentPage = 144;
                }
                if(bookSection)
                {
                    document.getElementById("sections").value = "History";
                }
                else
                {
                    document.getElementById("sections").value = "Geography";
                }
                updatePages(currentPage);
            }
        </script>
        <style>
            body{
                margin: 0px;
            }
            .container{
                object-fit: contain;
                transform-origin: top center;
                width: 935px;
                height: 606px;
                transform: scale(.5) translate(-50%, 0);
            }
            iframe
            {
                border: none;
                
            }
            body
            {
                display: flex;
                flex-direction: row;
                font-family: Arial, Helvetica, sans-serif;
            }
            .navbar
            {
                padding-top: 20px;
                display: flex;
                padding-left: 20px;
            }
            button
            {
                background: none;
                border: none;
                height: 20px;
                width: 20x
            }
            form
            {
                display: inline;
            }
            .arrow
            {
                width: 20px;height: 20px;position: absolute;transform: translate(-80%, -45%) scale(-1, 1);
            }

            #pageNo::placeholder
            {
                color: black;
            }
            #pageNo:focus::placeholder
            {
                color: #767676
            }
        </style>
    </head>
    <body>
        <div id="container" class="container">
            <iframe id="page1" frameborder="0" scrolling="no" class="page" width="935px" height="1212px" style="display: inline-block"></iframe>
            <iframe id="page2" frameborder="0" scrolling="no" class="page" width="935px" height="1212px" style="position:absolute"></iframe>
        </div>
        <div class="navbar">
            <button id="back" type="button" value="" onclick="incrementPage(-1)"><svg style="width: 20px;height: 20px;position: absolute;transform: translate(-80%, -45%) scale(-1, 1);" class="arrow" viewBox="0 0 330 330"><path id="XMLID_222_" d="M250.606,154.389l-150-149.996c-5.857-5.858-15.355-5.858-21.213,0.001  c-5.857,5.858-5.857,15.355,0.001,21.213l139.393,139.39L79.393,304.394c-5.857,5.858-5.857,15.355,0.001,21.213  C82.322,328.536,86.161,330,90,330s7.678-1.464,10.607-4.394l149.999-150.004c2.814-2.813,4.394-6.628,4.394-10.606  C255,161.018,253.42,157.202,250.606,154.389z"/></svg></button>
            <form onsubmit="jumpToPage()" id="form"><input id="pageNo" type="text" onsubmit="jumpToPage()"></form>
            <button id="forward" type="button" value="" onclick="incrementPage(1)"><svg style="width: 20px;height: 20px;position: absolute;transform: translate(-25%, -45%) scale(1, 1);" class="arrow" viewBox="0 0 330 330"><path id="XMLID_222_" d="M250.606,154.389l-150-149.996c-5.857-5.858-15.355-5.858-21.213,0.001  c-5.857,5.858-5.857,15.355,0.001,21.213l139.393,139.39L79.393,304.394c-5.857,5.858-5.857,15.355,0.001,21.213  C82.322,328.536,86.161,330,90,330s7.678-1.464,10.607-4.394l149.999-150.004c2.814-2.813,4.394-6.628,4.394-10.606  C255,161.018,253.42,157.202,250.606,154.389z"/></svg></button>
        </div>
        <div style="padding-top: 20px; padding-left: 10px;">
            <select id="sections" onchange="changeSection()">
                <option value="History">History</option>
                <option value="Geography">Geography</option>
            </select>
        </div>
        <a href="https://github.com/garvey96/matilda-education-good-humanities" target=”_blank” style="position: fixed; right:10px; bottom: 10px">GitHub / Download<img style="width:50px;height:50px" src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt=""></a>
    </body>
</html>
